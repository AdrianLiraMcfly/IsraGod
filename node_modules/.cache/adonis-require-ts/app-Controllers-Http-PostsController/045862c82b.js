"use strict";
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", { value: true });
const Post_1 = __importDefault(global[Symbol.for('ioc.use')]("App/Models/Post"));
const User_1 = __importDefault(global[Symbol.for('ioc.use')]("App/Models/User"));
class PostsController {
    async index({ response }) {
        const posts = await Post_1.default.query().preload('user');
        return response.status(200).json(posts);
    }
    async getPost(ctx) {
        const post = await Post_1.default.findOrFail(ctx.params.id);
        return post;
    }
    async store({ request, response }) {
        const user = await User_1.default.findOrFail(request.param('user_id'));
        const post = await Post_1.default.create(request.all());
        await post.related('user').associate(user);
        return response.status(201).json(post);
    }
    async update({ request, response }) {
        const post = await Post_1.default.findOrFail(request.param('id'));
        post.merge(request.all());
        await post.save();
        return response.status(200).json(post);
    }
    async destroy({ request, response }) {
        const post = await Post_1.default.findOrFail(request.param('id'));
        await post.delete();
        return response.status(204);
    }
}
exports.default = PostsController;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiUG9zdHNDb250cm9sbGVyLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiUG9zdHNDb250cm9sbGVyLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7O0FBQ0EsaUZBQWtDO0FBQ2xDLGlGQUFrQztBQUNsQyxNQUFxQixlQUFlO0lBQ3pCLEtBQUssQ0FBQyxLQUFLLENBQUMsRUFBQyxRQUFRLEVBQXNCO1FBQzlDLE1BQU0sS0FBSyxHQUFHLE1BQU0sY0FBSSxDQUFDLEtBQUssRUFBRSxDQUFDLE9BQU8sQ0FBQyxNQUFNLENBQUMsQ0FBQTtRQUNoRCxPQUFPLFFBQVEsQ0FBQyxNQUFNLENBQUMsR0FBRyxDQUFDLENBQUMsSUFBSSxDQUFDLEtBQUssQ0FBQyxDQUFBO0lBQzNDLENBQUM7SUFFTSxLQUFLLENBQUMsT0FBTyxDQUFDLEdBQXdCO1FBQ3pDLE1BQU0sSUFBSSxHQUFHLE1BQU0sY0FBSSxDQUFDLFVBQVUsQ0FBQyxHQUFHLENBQUMsTUFBTSxDQUFDLEVBQUUsQ0FBQyxDQUFBO1FBQ2pELE9BQU8sSUFBSSxDQUFBO0lBQ2YsQ0FBQztJQUVNLEtBQUssQ0FBQyxLQUFLLENBQUMsRUFBQyxPQUFPLEVBQUUsUUFBUSxFQUFzQjtRQUN2RCxNQUFNLElBQUksR0FBRyxNQUFNLGNBQUksQ0FBQyxVQUFVLENBQUMsT0FBTyxDQUFDLEtBQUssQ0FBQyxTQUFTLENBQUMsQ0FBQyxDQUFBO1FBQzVELE1BQU0sSUFBSSxHQUFHLE1BQU0sY0FBSSxDQUFDLE1BQU0sQ0FBQyxPQUFPLENBQUMsR0FBRyxFQUFFLENBQUMsQ0FBQTtRQUM3QyxNQUFNLElBQUksQ0FBQyxPQUFPLENBQUMsTUFBTSxDQUFDLENBQUMsU0FBUyxDQUFDLElBQUksQ0FBQyxDQUFBO1FBQzFDLE9BQU8sUUFBUSxDQUFDLE1BQU0sQ0FBQyxHQUFHLENBQUMsQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLENBQUE7SUFDMUMsQ0FBQztJQUVNLEtBQUssQ0FBQyxNQUFNLENBQUMsRUFBQyxPQUFPLEVBQUUsUUFBUSxFQUFzQjtRQUN4RCxNQUFNLElBQUksR0FBRyxNQUFNLGNBQUksQ0FBQyxVQUFVLENBQUMsT0FBTyxDQUFDLEtBQUssQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFBO1FBQ3ZELElBQUksQ0FBQyxLQUFLLENBQUMsT0FBTyxDQUFDLEdBQUcsRUFBRSxDQUFDLENBQUE7UUFDekIsTUFBTSxJQUFJLENBQUMsSUFBSSxFQUFFLENBQUE7UUFDakIsT0FBTyxRQUFRLENBQUMsTUFBTSxDQUFDLEdBQUcsQ0FBQyxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsQ0FBQTtJQUMxQyxDQUFDO0lBRU0sS0FBSyxDQUFDLE9BQU8sQ0FBQyxFQUFDLE9BQU8sRUFBRSxRQUFRLEVBQXNCO1FBQ3pELE1BQU0sSUFBSSxHQUFHLE1BQU0sY0FBSSxDQUFDLFVBQVUsQ0FBQyxPQUFPLENBQUMsS0FBSyxDQUFDLElBQUksQ0FBQyxDQUFDLENBQUE7UUFDdkQsTUFBTSxJQUFJLENBQUMsTUFBTSxFQUFFLENBQUE7UUFDbkIsT0FBTyxRQUFRLENBQUMsTUFBTSxDQUFDLEdBQUcsQ0FBQyxDQUFBO0lBQy9CLENBQUM7Q0FDSjtBQTlCRCxrQ0E4QkMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgdHlwZSB7IEh0dHBDb250ZXh0Q29udHJhY3QgfSBmcm9tICdAaW9jOkFkb25pcy9Db3JlL0h0dHBDb250ZXh0J1xyXG5pbXBvcnQgUG9zdCBmcm9tICdBcHAvTW9kZWxzL1Bvc3QnXHJcbmltcG9ydCBVc2VyIGZyb20gJ0FwcC9Nb2RlbHMvVXNlcidcclxuZXhwb3J0IGRlZmF1bHQgY2xhc3MgUG9zdHNDb250cm9sbGVyIHtcclxuICAgIHB1YmxpYyBhc3luYyBpbmRleCh7cmVzcG9uc2V9OiBIdHRwQ29udGV4dENvbnRyYWN0KSB7XHJcbiAgICAgICAgY29uc3QgcG9zdHMgPSBhd2FpdCBQb3N0LnF1ZXJ5KCkucHJlbG9hZCgndXNlcicpXHJcbiAgICAgICAgcmV0dXJuIHJlc3BvbnNlLnN0YXR1cygyMDApLmpzb24ocG9zdHMpXHJcbiAgICB9XHJcblxyXG4gICAgcHVibGljIGFzeW5jIGdldFBvc3QoY3R4OiBIdHRwQ29udGV4dENvbnRyYWN0KSB7XHJcbiAgICAgICAgY29uc3QgcG9zdCA9IGF3YWl0IFBvc3QuZmluZE9yRmFpbChjdHgucGFyYW1zLmlkKVxyXG4gICAgICAgIHJldHVybiBwb3N0XHJcbiAgICB9XHJcblxyXG4gICAgcHVibGljIGFzeW5jIHN0b3JlKHtyZXF1ZXN0LCByZXNwb25zZX06IEh0dHBDb250ZXh0Q29udHJhY3QpIHtcclxuICAgICAgICBjb25zdCB1c2VyID0gYXdhaXQgVXNlci5maW5kT3JGYWlsKHJlcXVlc3QucGFyYW0oJ3VzZXJfaWQnKSlcclxuICAgICAgICBjb25zdCBwb3N0ID0gYXdhaXQgUG9zdC5jcmVhdGUocmVxdWVzdC5hbGwoKSlcclxuICAgICAgICBhd2FpdCBwb3N0LnJlbGF0ZWQoJ3VzZXInKS5hc3NvY2lhdGUodXNlcilcclxuICAgICAgICByZXR1cm4gcmVzcG9uc2Uuc3RhdHVzKDIwMSkuanNvbihwb3N0KVxyXG4gICAgfVxyXG5cclxuICAgIHB1YmxpYyBhc3luYyB1cGRhdGUoe3JlcXVlc3QsIHJlc3BvbnNlfTogSHR0cENvbnRleHRDb250cmFjdCkge1xyXG4gICAgICAgIGNvbnN0IHBvc3QgPSBhd2FpdCBQb3N0LmZpbmRPckZhaWwocmVxdWVzdC5wYXJhbSgnaWQnKSlcclxuICAgICAgICBwb3N0Lm1lcmdlKHJlcXVlc3QuYWxsKCkpXHJcbiAgICAgICAgYXdhaXQgcG9zdC5zYXZlKClcclxuICAgICAgICByZXR1cm4gcmVzcG9uc2Uuc3RhdHVzKDIwMCkuanNvbihwb3N0KVxyXG4gICAgfVxyXG5cclxuICAgIHB1YmxpYyBhc3luYyBkZXN0cm95KHtyZXF1ZXN0LCByZXNwb25zZX06IEh0dHBDb250ZXh0Q29udHJhY3QpIHtcclxuICAgICAgICBjb25zdCBwb3N0ID0gYXdhaXQgUG9zdC5maW5kT3JGYWlsKHJlcXVlc3QucGFyYW0oJ2lkJykpXHJcbiAgICAgICAgYXdhaXQgcG9zdC5kZWxldGUoKVxyXG4gICAgICAgIHJldHVybiByZXNwb25zZS5zdGF0dXMoMjA0KVxyXG4gICAgfVxyXG59XHJcbiJdfQ==